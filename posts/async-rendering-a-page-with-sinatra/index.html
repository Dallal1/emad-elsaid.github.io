<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Emad Elsaid">
<meta name="description" content="Ruby/Go Web Developer">
<meta name="generator" content="Hugo 0.68.3" />
<title>Async Rendering a Page With Sinatra</title>
<link rel="shortcut icon" href="http://www.emadelsaid.com/images/favicon.ico">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/style.css">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/highlight.css">

<link rel="stylesheet" href="http://www.emadelsaid.com/css/custom_style.css">



<link rel="stylesheet" href="http://www.emadelsaid.com/css/monosocialiconsfont.css">



<link href="http://www.emadelsaid.com/index.xml" rel="alternate" type="application/rss+xml" title="Emad Elsaid" />


<meta property="og:title" content="Async Rendering a Page With Sinatra" />
<meta property="og:description" content="I was thinking, what if you need a server that serves a page that does alot of processing, it sends multiple commands, does alot of queries and most of them takes a long time.
Waiting for all commands to finish isn&rsquo;t an option, fast response time is also a requirement, so a solution could be warming up a cache then render the page from this cache.
That solution means you will also wait for all commands/queries to finish then respond with your output." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.emadelsaid.com/posts/async-rendering-a-page-with-sinatra/" />
<meta property="article:published_time" content="2018-10-28T14:30:04+01:00" />
<meta property="article:modified_time" content="2018-10-28T14:30:04+01:00" />


<meta itemprop="name" content="Async Rendering a Page With Sinatra">
<meta itemprop="description" content="I was thinking, what if you need a server that serves a page that does alot of processing, it sends multiple commands, does alot of queries and most of them takes a long time.
Waiting for all commands to finish isn&rsquo;t an option, fast response time is also a requirement, so a solution could be warming up a cache then render the page from this cache.
That solution means you will also wait for all commands/queries to finish then respond with your output.">
<meta itemprop="datePublished" content="2018-10-28T14:30:04&#43;01:00" />
<meta itemprop="dateModified" content="2018-10-28T14:30:04&#43;01:00" />
<meta itemprop="wordCount" content="404">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Async Rendering a Page With Sinatra"/>
<meta name="twitter:description" content="I was thinking, what if you need a server that serves a page that does alot of processing, it sends multiple commands, does alot of queries and most of them takes a long time.
Waiting for all commands to finish isn&rsquo;t an option, fast response time is also a requirement, so a solution could be warming up a cache then render the page from this cache.
That solution means you will also wait for all commands/queries to finish then respond with your output."/>
<meta name="twitter:site" content="@https://www.twitter.com/emad__elsaid"/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='http://www.emadelsaid.com/'> <span class="arrow">←</span>All Articles</a>
	

	

	
		<a class="cta" href="http://www.emadelsaid.com/index.xml">RSS</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Async Rendering a Page With Sinatra</h1>
        <h2 class="subtitle"></h2>
        <h2 class="headline">
        October 28, 2018
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        <p>I was thinking, what if you need a server that serves a page that does alot of
processing, it sends multiple commands, does alot of queries and most of them
takes a long time.</p>
<p>Waiting for all commands to finish isn&rsquo;t an option, fast response time is also a
requirement, so a solution could be warming up a cache then render the page from
this cache.</p>
<p>That solution means you will also wait for all commands/queries to finish then
respond with your output.</p>
<p>But do we have to wait to for all of them? what if we can render what&rsquo;s done and
ignore the rest, and when we render the page again maybe other commands/queries
are finished so we render them and so on until we try to request the page one
time and all queries are done so we&rsquo;ll render the full page.</p>
<p>I think this isn&rsquo;t a new idea, I vaguely remember a ruby framework that does
this Async widgets but can&rsquo;t remember the name at all, maybe it was introduced in
one of the ruby/rails conferences/talks.</p>
<p>The solution I came up with is straight forward, the interface for you should be
a method that you can pass a block and a default value, that method will
execute that block, if the block takes a long time it&rsquo;ll return the default
value until one time that method is executed while requesting the page and it&rsquo;ll
return the block return value.</p>
<p>That solution require us to execute the block in a non-blocking way, so to do
that let&rsquo;s create a new thread for that block.</p>
<p>Now you have a thread running in the background, the method when called again
should have a track of what blocks created and what&rsquo;s not, so a cache has to
exist for each block you try to execute, and whenever this method is called it
creates or gets the output of the block.</p>
<p>The solution will allow you to render each part of the page asynchronously, as
the interface is simply a method call taking a block.</p>
<p>The following gist may show you how this could be implemented, it&rsquo;s a simple
Sinatra server, that renders the output of <code>ps</code> executed on a remote server,
when the page is rendered the block will be sent to the background and the page
will be empty, and when you refresh the method call will return the output if
the block finished</p>
<script type="application/javascript" src="https://gist.github.com/emad-elsaid/c059b48191bde7030f34aa77b35bc304.js"></script>


    </section>
</article>

<footer id="post-meta" class="clearfix">
    <a href="https://twitter.com/emad__elsaid">
    <img class="avatar" src="http://www.emadelsaid.com/images/avatar.png">
    <div>
        <span class="dark">Emad Elsaid</span>
        <span>Software Engineer, Ruby/Go Web Developer</span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fwww.emadelsaid.com%2fposts%2fasync-rendering-a-page-with-sinatra%2f - Async%20Rendering%20a%20Page%20With%20Sinatra by @emad__elsaid"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/posts/window10-disconnects-reconnects-usb-bluetooth/">Window10 Disconnects Reconnects Usb Bluetooth<aside class="dates">May 15 2020</aside></a>
        </li>
    
        <li>
            <a href="/posts/git-as-messages-queue/">Git as Messages Queue<aside class="dates">Nov 10 2019</aside></a>
        </li>
    
        <li>
            <a href="/posts/tracing-ruby-applications-execution-in-4-lines/">Tracing Ruby Applications Execution in 4 Lines<aside class="dates">May 23 2019</aside></a>
        </li>
    
        <li>
            <a href="/posts/representing-named-entity-mention-in-postgres-for-fast-queries/">Representing Named Entity Mention in Postgres for Fast Queries<aside class="dates">Dec 14 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/cloning-all-your-github-repositories-or-updating-them-in-one-command/">Cloning All Your GitHub Repositories or Updating Them in One Command<aside class="dates">Oct 29 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%85%D8%B1%D8%A7%D8%AC%D8%B9%D8%A9-%D8%B1%D9%88%D8%A7%D9%8A%D8%A9-the-gods-themselves/">مراجعة رواية The Gods Themselves<aside class="dates">May 1 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%82%D8%A7%D9%87%D8%B1%D8%A9-%D8%A7%D9%84%D8%B7%D8%A7%D9%82%D8%A9-%D8%A7%D9%84%D9%86%D9%88%D9%88%D9%8A%D8%A9/">قاهرة الطاقة النووية<aside class="dates">Mar 25 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D8%A7%D9%84%D8%B9%D8%B5%D8%A8%D9%8A%D8%A9-%D8%A7%D9%84%D9%82%D8%A8%D9%84%D9%8A%D8%A9-%D9%81%D9%89-%D9%85%D8%AC%D8%AA%D9%85%D8%B9-%D9%85%D8%B7%D9%88%D8%B1%D9%89-%D8%A7%D9%84%D8%A8%D8%B1%D9%85%D8%AC%D9%8A%D8%A7%D8%AA/">العصبية القبلية فى مجتمع مطورى البرمجيات<aside class="dates">Mar 22 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%85%D8%AA%D9%8A-%D8%AA%D9%88%D9%82%D9%81%D9%86%D8%A7-%D8%B9%D9%86-%D8%AA%D8%B5%D9%88%D8%B1-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%82%D8%A8%D9%84/">متي توقفنا عن تصور المستقبل<aside class="dates">Feb 24 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/getting-your-cpu-speed-in-ghz-on-linux/">Getting Your CPU Speed in GHz on Linux<aside class="dates">Feb 12 2018</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    
    <a class="symbol" href="https://www.facebook.com/emad.elsaid.hamed">
        roundedfacebook
    </a>
    
    <a class="symbol" href="https://www.github.com/emad-elsaid">
        roundedgithub
    </a>
    
    <a class="symbol" href="https://www.twitter.com/emad__elsaid">
        roundedtwitterbird
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2020 Emad Elsaid
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://www.emadelsaid.com/js/main.js"></script>
<script src="http://www.emadelsaid.com/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-112396214-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
