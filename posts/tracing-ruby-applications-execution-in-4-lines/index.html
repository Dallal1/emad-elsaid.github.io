<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Emad Elsaid">
<meta name="description" content="Ruby/Go Web Developer">
<meta name="generator" content="Hugo 0.71.0" />
<title>Tracing Ruby Applications Execution in 4 Lines</title>
<link rel="shortcut icon" href="http://www.emadelsaid.com/images/favicon.ico">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/style.css">
<link rel="stylesheet" href="http://www.emadelsaid.com/css/highlight.css">

<link rel="stylesheet" href="http://www.emadelsaid.com/css/custom_style.css">



<link rel="stylesheet" href="http://www.emadelsaid.com/css/monosocialiconsfont.css">



<link href="http://www.emadelsaid.com/index.xml" rel="alternate" type="application/rss+xml" title="Emad Elsaid" />


<meta property="og:title" content="Tracing Ruby Applications Execution in 4 Lines" />
<meta property="og:description" content="I was researching a simple way to trace ruby code, so the problem I tried to solve (as usual) is to understand the code infront of me even more, so I need some monitor, when I open a rails server and I navigate around, I need to see the methods executed and where is it located, I need to see that in realtime.
Turns out the solution is very simple, as Ruby has TracePoint module, you can use it to log any thing gets called in your application, so adding this snippet to your rails initializers or anywhere before your application starts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.emadelsaid.com/posts/tracing-ruby-applications-execution-in-4-lines/" />
<meta property="article:published_time" content="2019-05-23T17:46:35+02:00" />
<meta property="article:modified_time" content="2019-05-23T17:46:35+02:00" />


<meta itemprop="name" content="Tracing Ruby Applications Execution in 4 Lines">
<meta itemprop="description" content="I was researching a simple way to trace ruby code, so the problem I tried to solve (as usual) is to understand the code infront of me even more, so I need some monitor, when I open a rails server and I navigate around, I need to see the methods executed and where is it located, I need to see that in realtime.
Turns out the solution is very simple, as Ruby has TracePoint module, you can use it to log any thing gets called in your application, so adding this snippet to your rails initializers or anywhere before your application starts.">
<meta itemprop="datePublished" content="2019-05-23T17:46:35&#43;02:00" />
<meta itemprop="dateModified" content="2019-05-23T17:46:35&#43;02:00" />
<meta itemprop="wordCount" content="385">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tracing Ruby Applications Execution in 4 Lines"/>
<meta name="twitter:description" content="I was researching a simple way to trace ruby code, so the problem I tried to solve (as usual) is to understand the code infront of me even more, so I need some monitor, when I open a rails server and I navigate around, I need to see the methods executed and where is it located, I need to see that in realtime.
Turns out the solution is very simple, as Ruby has TracePoint module, you can use it to log any thing gets called in your application, so adding this snippet to your rails initializers or anywhere before your application starts."/>
<meta name="twitter:site" content="@https://www.twitter.com/emad__elsaid"/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='http://www.emadelsaid.com/'> <span class="arrow">‚Üê</span>All Articles</a>
	

	

	
		<a class="cta" href="http://www.emadelsaid.com/index.xml">RSS</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Tracing Ruby Applications Execution in 4 Lines</h1>
        <h2 class="subtitle"></h2>
        <h2 class="headline">
        May 23, 2019
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        <p>I was researching a simple way to trace ruby code, so the problem I tried to
solve (as usual) is to understand the code infront of me even more, so I need
some monitor, when I open a rails server and I navigate around, I need to see
the methods executed and where is it located, I need to see that in realtime.</p>
<p>Turns out the solution is very simple, as Ruby has <code>TracePoint</code> module, you can
use it to log any thing gets called in your application, so adding this snippet
to your rails initializers or anywhere before your application starts.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">TracePoint</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">:call</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>tp<span style="color:#f92672">|</span>
  puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>path <span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">#{</span>tp<span style="color:#f92672">.</span>lineno<span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>defined_class <span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>method_id <span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>enable
</code></pre></div><p>That should print every method call to your standard output, but you&rsquo;ll discover
early that everything is too much, you need to ignore method calls that doesn&rsquo;t
belong to your application code, like <code>puma</code> server method calls, or any
external gem calls, so lets limit it to our application by adding a suffix <code>if</code>
to the <code>puts</code> line.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">TracePoint</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">:call</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>tp<span style="color:#f92672">|</span>
  puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>path <span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">#{</span>tp<span style="color:#f92672">.</span>lineno<span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>defined_class <span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>method_id <span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> tp<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#39;/app/&#39;</span>)
<span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>enable
</code></pre></div><p>that should limit it to method calls located under <code>/app</code> directory, but as you
know your application also logs stuff, so it doesn&rsquo;t make sense to log to
STDOUT, lets separate that logs to a log file, and as my <code>/tmp</code> directory is a
<code>tmpfs</code> mapped to memory not SSD, it&rsquo;ll be fast and volatile, so I don&rsquo;t care to
clean it up afterwards.</p>
<p>And for that I&rsquo;ll createa a logger to a file in <code>/tmp</code> and use it to print these
executions</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">logger <span style="color:#f92672">=</span> <span style="color:#66d9ef">Logger</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;/tmp/trace.log&#39;</span>, <span style="color:#66d9ef">File</span><span style="color:#f92672">::</span><span style="color:#66d9ef">WRONLY</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">::</span><span style="color:#66d9ef">APPEND</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">::</span><span style="color:#66d9ef">CREAT</span>)
<span style="color:#66d9ef">TracePoint</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">:call</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>tp<span style="color:#f92672">|</span>
  logger<span style="color:#f92672">.</span>debug <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>path <span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">#{</span>tp<span style="color:#f92672">.</span>lineno<span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>defined_class <span style="color:#e6db74">}</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">#{</span> tp<span style="color:#f92672">.</span>method_id <span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">if</span> tp<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#39;/app/&#39;</span>)
<span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>enable
</code></pre></div><p>So now you can <code>tail -f /tmp/trace.log</code> to see your application execution in
realtime, but you&rsquo;ll learn also that you need to filter the logs or search in
them, so that can be done by piping your log file to <code>fzf</code> you can find it
<a href="https://github.com/junegunn/fzf">here</a> so to see your logs and search through
them now you can execute this in your shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /tmp/trace.log | fzf
</code></pre></div><p>If you want to have your whole screen filled with fzf and the input prompt to
the top you can add <code>--layout=reverse</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /tmp/trace.log | fzf --layout<span style="color:#f92672">=</span>reverse
</code></pre></div>
    </section>
</article>

<footer id="post-meta" class="clearfix">
    <a href="https://twitter.com/emad__elsaid">
    <img class="avatar" src="http://www.emadelsaid.com/images/avatar.png">
    <div>
        <span class="dark">Emad Elsaid</span>
        <span>Software Engineer, Ruby/Go Web Developer</span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fwww.emadelsaid.com%2fposts%2ftracing-ruby-applications-execution-in-4-lines%2f - Tracing%20Ruby%20Applications%20Execution%20in%204%20Lines by @emad__elsaid"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="/posts/monitor-window10-foreground-window/">Monitor Window10 Foreground Window<aside class="dates">May 31 2020</aside></a>
        </li>
    
        <li>
            <a href="/posts/window10-disconnects-reconnects-usb-bluetooth/">Window10 Disconnects Reconnects Usb Bluetooth<aside class="dates">May 15 2020</aside></a>
        </li>
    
        <li>
            <a href="/posts/git-as-messages-queue/">Git as Messages Queue<aside class="dates">Nov 10 2019</aside></a>
        </li>
    
        <li>
            <a href="/posts/representing-named-entity-mention-in-postgres-for-fast-queries/">Representing Named Entity Mention in Postgres for Fast Queries<aside class="dates">Dec 14 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/cloning-all-your-github-repositories-or-updating-them-in-one-command/">Cloning All Your GitHub Repositories or Updating Them in One Command<aside class="dates">Oct 29 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/async-rendering-a-page-with-sinatra/">Async Rendering a Page With Sinatra<aside class="dates">Oct 28 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%85%D8%B1%D8%A7%D8%AC%D8%B9%D8%A9-%D8%B1%D9%88%D8%A7%D9%8A%D8%A9-the-gods-themselves/">ŸÖÿ±ÿßÿ¨ÿπÿ© ÿ±ŸàÿßŸäÿ© The Gods Themselves<aside class="dates">May 1 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%82%D8%A7%D9%87%D8%B1%D8%A9-%D8%A7%D9%84%D8%B7%D8%A7%D9%82%D8%A9-%D8%A7%D9%84%D9%86%D9%88%D9%88%D9%8A%D8%A9/">ŸÇÿßŸáÿ±ÿ© ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑŸÜŸàŸàŸäÿ©<aside class="dates">Mar 25 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D8%A7%D9%84%D8%B9%D8%B5%D8%A8%D9%8A%D8%A9-%D8%A7%D9%84%D9%82%D8%A8%D9%84%D9%8A%D8%A9-%D9%81%D9%89-%D9%85%D8%AC%D8%AA%D9%85%D8%B9-%D9%85%D8%B7%D9%88%D8%B1%D9%89-%D8%A7%D9%84%D8%A8%D8%B1%D9%85%D8%AC%D9%8A%D8%A7%D8%AA/">ÿßŸÑÿπÿµÿ®Ÿäÿ© ÿßŸÑŸÇÿ®ŸÑŸäÿ© ŸÅŸâ ŸÖÿ¨ÿ™ŸÖÿπ ŸÖÿ∑Ÿàÿ±Ÿâ ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™<aside class="dates">Mar 22 2018</aside></a>
        </li>
    
        <li>
            <a href="/posts/%D9%85%D8%AA%D9%8A-%D8%AA%D9%88%D9%82%D9%81%D9%86%D8%A7-%D8%B9%D9%86-%D8%AA%D8%B5%D9%88%D8%B1-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D9%82%D8%A8%D9%84/">ŸÖÿ™Ÿä ÿ™ŸàŸÇŸÅŸÜÿß ÿπŸÜ ÿ™ÿµŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ<aside class="dates">Feb 24 2018</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
        <div id="social">

	
	
    
    <a class="symbol" href="https://www.facebook.com/emad.elsaid.hamed">
        roundedfacebook
    </a>
    
    <a class="symbol" href="https://www.github.com/emad-elsaid">
        roundedgithub
    </a>
    
    <a class="symbol" href="https://www.twitter.com/emad__elsaid">
        roundedtwitterbird
    </a>
    


</div>

    
    <p class="small">
    
        ¬© Copyright 2020 Emad Elsaid
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://www.emadelsaid.com/js/main.js"></script>
<script src="http://www.emadelsaid.com/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-112396214-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
